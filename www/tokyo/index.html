<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="Cache-Control" content="no-store" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>loopeeTokyo</title>
    <!-- <script type="text/javascript" src="main.js"></script> -->
    <!-- <link rel="stylesheet" href="main.css"> -->
    <style>
      #main-container{
        width: 100vw;
        /* background-color: lightskyblue; */
      }
    </style>
    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap JS -->
    <script src="js/bootstrap.bundle.min.js"></script>

  </head>
  
  <body>
    <label id="gameStatus">gameStatus</label><br>
    <div class="input-group input-group-sm mb-3">
      <span class="input-group-text" id="questionCode">XX</span>
      <input type="text" class="form-control" aria-describedby="questionCode" placeholder="Enter the answer">
    </div>
    <input type="checkbox" class="btn-check btn-success" id="checkCode1">
    <label class="btn btn-outline-success" for="checkCode1">1</label>
    <input type="checkbox" class="btn-check btn-success" id="checkCode2">
    <label class="btn btn-outline-success" for="checkCode2">2</label>
    <input type="checkbox" class="btn-check btn-success" id="checkCode3">
    <label class="btn btn-outline-success" for="checkCode3">3</label>
    <input type="checkbox" class="btn-check" id="checkCode4">
    <label class="btn btn-outline-primary" for="checkCode4">4</label>
    <input type="checkbox" class="btn-check" id="checkCode5">
    <label class="btn btn-outline-primary" for="checkCode5">5</label>
    <input type="checkbox" class="btn-check" id="checkCode6">
    <label class="btn btn-outline-primary" for="checkCode6">6</label>

    <br>

    <input type="button" class="btn btn-primary" value="PLAY" onclick="clickPlay()">
    <input type="button" class="btn btn-primary" value="ENTRY" onclick="clickOk()">
    <div id="main-container"></div>
    <div id="sub-container"></div>
    <label id="hint"></label><br>
    <script type="module">
      import * as question from './js/question.js';
      import * as svg from './js/svg.js';
      let m_clickCount=0;
      let m_readyCount = 0;
      let m_targetCode = "1";
      let m_mode = 'veryEasy'
      const requestURL = './contents.json'; //CROSSエラーコード
      let request = new XMLHttpRequest(); 

      window.clickOk = clickOk;
      window.clickPlay = clickPlay;
      setParameter();
      request.open('GET', requestURL);
      request.responseType = 'json';
      request.send();
      request.onload = function (){
        let jsonData = request.response;
        question.setData(jsonData,m_mode,m_targetCode);

        for (let index in question.answer) {
          if(question.kana[index].length > 0){
            document.getElementById('hint').textContent += question.answer[index] + "(" + question.kana[index] +")/";
          }else{
            document.getElementById('hint').textContent += question.answer[index] + "/";
          }
        } 
        let intervalId = setInterval(firstStart => {
          let dot = '';
          if(m_readyCount < 0){
            clearInterval(intervalId);
            main();
            return;
          }
          for(let i=0;i<m_readyCount;i++){
            dot += '.';
          }
          document.getElementById('gameStatus').textContent = 'Ready' + dot;
          m_readyCount = m_readyCount - 1;
        },1000);
      }
      function setParameter(){
        let param = location.search.split('&');
        if(param.length === 2){
          m_mode = param[0].split('=')[1];
          m_targetCode = param[1].split('=')[1];
        }else{
          console.log('no param');
        }
      }
      function main(){
        svg.setObserverGame();

        document.getElementById("questionCode").innerText = question.questionCode[m_clickCount];
        svg.draw(question.pos[m_clickCount][0],question.pos[m_clickCount][1]);
        m_clickCount += 1;
      }
      function clickPlay(){
        console.log('click play');
        svg.drawMapFullMainContainer();
      }
      function clickSample(){
        console.log('call clickSample');
      }
      function clickOk(){

        if(typeof question.pos != 'undefined'){
          document.getElementById("questionCode").innerText = question.questionCode[m_clickCount];
          svg.draw(question.pos[m_clickCount][0],question.pos[m_clickCount][1]);
          m_clickCount += 1;
        }
      }
    </script>
  </body>

</html>
