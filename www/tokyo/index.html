<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="Cache-Control" content="no-store" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>loopeeTokyo</title>
    <!-- <script type="text/javascript" src="main.js"></script> -->
    <!-- <link rel="stylesheet" href="main.css"> -->
    <style>
      #main-container{
        width: 100vw;
        /* background-color: lightskyblue; */
      }
    </style>

  </head>
  
  <body>
    <label id="gameStatus">gameStatus</label><br>
    <label id="questionCode">questionCode</label><br>
    <input type="text" id="inputTarget" placeholder="targetCode"><br>
    <input type="button" value="OK" onclick="clickOk()">
    <div id="main-container"></div>
    <div id="sub-container"></div>
    <label id="hint"></label><br>
    <script type="module">
      import * as question from './question.js';
      import * as svg from './svg.js';
      let m_clickCount=0;
      let m_readyCount = 0;
      let m_targetCode = "1";
      let m_mode = 'veryEasy'
      const requestURL = './contents.json'; //CROSSエラーコード
      let request = new XMLHttpRequest(); 

      window.clickOk = clickOk;   
      setParameter();
      request.open('GET', requestURL);
      request.responseType = 'json';
      request.send();
      request.onload = function (){
        let jsonData = request.response;
        question.setData(jsonData,m_mode,m_targetCode);

        for (let index in question.answer) {
          if(question.kana[index].length > 0){
            document.getElementById('hint').textContent += question.answer[index] + "(" + question.kana[index] +")/";
          }else{
            document.getElementById('hint').textContent += question.answer[index] + "/";
          }
        } 
        let intervalId = setInterval(firstStart => {
          let dot = '';
          if(m_readyCount < 0){
            clearInterval(intervalId);
            main();
            return;
          }
          for(let i=0;i<m_readyCount;i++){
            dot += '.';
          }
          document.getElementById('gameStatus').textContent = 'Ready' + dot;
          m_readyCount = m_readyCount - 1;
        },1000);
      }
      function setParameter(){
        let param = location.search.split('&');
        if(param.length === 2){
          m_mode = param[0].split('=')[1];
          m_targetCode = param[1].split('=')[1];
        }else{
          console.log('no param');
        }
      }
      function main(){
        document.getElementById("questionCode").textContent = question.questionCode[m_clickCount];
        svg.draw(question.pos[m_clickCount][0],question.pos[m_clickCount][1]);
        m_clickCount += 1;
       }

      function clickOk(){
        if(typeof question.pos != 'undefined'){
          document.getElementById("questionCode").textContent = question.questionCode[m_clickCount];
          svg.draw(question.pos[m_clickCount][0],question.pos[m_clickCount][1]);
          m_clickCount += 1;
        }
      }
    </script>
  </body>

</html>
